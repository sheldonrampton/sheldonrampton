<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8">
<title>includes/actions.inc File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css">
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.5.8 -->
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="index.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="pages.html"><span>Related&nbsp;Pages</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
  <div class="tabs">
    <ul>
      <li><a href="files.html"><span>File&nbsp;List</span></a></li>
      <li><a href="globals.html"><span>File&nbsp;Members</span></a></li>
    </ul>
  </div>
</div>
<div class="contents">
<h1>includes/actions.inc File Reference</h1><table border="0" cellpadding="0" cellspacing="0">
<tr><td></td></tr>
<tr><td colspan="2"><br><h2>Functions</h2></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="actions_8inc.html#7da5f346de3d54e5b0cee717a6f2d390">actions_do</a> ($action_ids, &amp;$object, $context=NULL, $a1=NULL, $a2=NULL)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="actions_8inc.html#d0dbf276d4ca1834760cffc7e1b1be53">actions_list</a> ($reset=FALSE)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="actions_8inc.html#4275e9fee609ba6e85b03278a681436c">actions_get_all_actions</a> ()</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="actions_8inc.html#d943b3f497c80809d895ecc01490d10f">actions_actions_map</a> ($actions)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="actions_8inc.html#4a0e35c01b48d1a413889948c061a6f0">actions_function_lookup</a> ($hash)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="actions_8inc.html#a4445cbadb5d03206c4a724581b2b30c">actions_synchronize</a> ($actions_in_code=array(), $delete_orphans=FALSE)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="actions_8inc.html#58e2d372003a208c732f98cfb00b1c98">actions_save</a> ($function, $type, $params, $desc, $aid=NULL)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="actions_8inc.html#1e953639945d342b20fe51b8d21095cc">actions_load</a> ($aid)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="actions_8inc.html#857468911c3dd6f839cbdb14c6ed80ac">actions_delete</a> ($aid)</td></tr>

</table>
<hr><a name="_details"></a><h2>Detailed Description</h2>
This is the actions engine for executing stored actions. <hr><h2>Function Documentation</h2>
<a class="anchor" name="d943b3f497c80809d895ecc01490d10f"></a><!-- doxytag: member="actions.inc::actions_actions_map" ref="d943b3f497c80809d895ecc01490d10f" args="($actions)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">actions_actions_map           </td>
          <td>(</td>
          <td class="paramtype">$&nbsp;</td>
          <td class="paramname"> <em>actions</em>          </td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Create an associative array keyed by md5 hashes of function names.<p>
Hashes are used to prevent actual function names from going out into HTML forms and coming back.<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>$actions</em>&nbsp;</td><td>An associative array with function names as keys and associative arrays with keys 'description', 'type', etc. as values. Generally the output of <a class="el" href="actions_8inc.html#d0dbf276d4ca1834760cffc7e1b1be53">actions_list()</a> or <a class="el" href="actions_8inc.html#4275e9fee609ba6e85b03278a681436c">actions_get_all_actions()</a> is given as input to this function.</td></tr>
  </table>
</dl>
<dl class="return" compact><dt><b>Returns:</b></dt><dd>An associative array keyed on md5 hash of function name. The value of each key is an associative array of function, description, and type for the action. </dd></dl>

</div>
</div><p>
<a class="anchor" name="857468911c3dd6f839cbdb14c6ed80ac"></a><!-- doxytag: member="actions.inc::actions_delete" ref="857468911c3dd6f839cbdb14c6ed80ac" args="($aid)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">actions_delete           </td>
          <td>(</td>
          <td class="paramtype">$&nbsp;</td>
          <td class="paramname"> <em>aid</em>          </td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Delete a single action from the database.<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>$aid</em>&nbsp;</td><td>integer The ID of the action to delete. </td></tr>
  </table>
</dl>

</div>
</div><p>
<a class="anchor" name="7da5f346de3d54e5b0cee717a6f2d390"></a><!-- doxytag: member="actions.inc::actions_do" ref="7da5f346de3d54e5b0cee717a6f2d390" args="($action_ids, &amp;$object, $context=NULL, $a1=NULL, $a2=NULL)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">actions_do           </td>
          <td>(</td>
          <td class="paramtype">$&nbsp;</td>
          <td class="paramname"> <em>action_ids</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&amp;$&nbsp;</td>
          <td class="paramname"> <em>object</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">$&nbsp;</td>
          <td class="paramname"> <em>context</em> = <code>NULL</code>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">$&nbsp;</td>
          <td class="paramname"> <em>a1</em> = <code>NULL</code>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">$&nbsp;</td>
          <td class="paramname"> <em>a2</em> = <code>NULL</code></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Perform a given list of actions by executing their callback functions.<p>
Given the IDs of actions to perform, find out what the callbacks for the actions are by querying the database. Then call each callback using the function call $function($object, $context, $a1, $a2) where $function is the name of a function written in compliance with the action specification; that is, foo($object, $context).<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>$action_ids</em>&nbsp;</td><td>The ID of the action to perform. Can be a single action ID or an array of IDs. IDs of instances will be numeric; IDs of singletons will be function names. </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>$object</em>&nbsp;</td><td>Parameter that will be passed along to the callback. Typically the object that the action will act on; a node, user or comment object. If the action does not act on an object, pass a dummy object. This is necessary to support PHP 4 object referencing. </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>$context</em>&nbsp;</td><td>Parameter that will be passed along to the callback. $context is a keyed array containing extra information about what is currently happening at the time of the call. Typically $context['hook'] and $context['op'] will tell which hook-op combination resulted in this call to <a class="el" href="actions_8inc.html#7da5f346de3d54e5b0cee717a6f2d390">actions_do()</a>. </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>$a1</em>&nbsp;</td><td>Parameter that will be passed along to the callback. </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>$a2</em>&nbsp;</td><td>Parameter that will be passed along to the callback.</td></tr>
  </table>
</dl>
<dl class="return" compact><dt><b>Returns:</b></dt><dd>An associative array containing the result of the function that performs the action, keyed on action ID. </dd></dl>

</div>
</div><p>
<a class="anchor" name="4a0e35c01b48d1a413889948c061a6f0"></a><!-- doxytag: member="actions.inc::actions_function_lookup" ref="4a0e35c01b48d1a413889948c061a6f0" args="($hash)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">actions_function_lookup           </td>
          <td>(</td>
          <td class="paramtype">$&nbsp;</td>
          <td class="paramname"> <em>hash</em>          </td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Given an md5 hash of a function name, return the function name.<p>
Faster than <a class="el" href="actions_8inc.html#d943b3f497c80809d895ecc01490d10f">actions_actions_map()</a> when you only need the function name.<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>$hash</em>&nbsp;</td><td>MD5 hash of a function name</td></tr>
  </table>
</dl>
<dl class="return" compact><dt><b>Returns:</b></dt><dd>Function name </dd></dl>

</div>
</div><p>
<a class="anchor" name="4275e9fee609ba6e85b03278a681436c"></a><!-- doxytag: member="actions.inc::actions_get_all_actions" ref="4275e9fee609ba6e85b03278a681436c" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">actions_get_all_actions           </td>
          <td>(</td>
          <td class="paramname">          </td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Retrieves all action instances from the database.<p>
Compare with <a class="el" href="actions_8inc.html#d0dbf276d4ca1834760cffc7e1b1be53">actions_list()</a>, which gathers actions by invoking hook_action_info(). The actions returned by this function and the actions returned by <a class="el" href="actions_8inc.html#d0dbf276d4ca1834760cffc7e1b1be53">actions_list()</a> are partially synchronized. Non-configurable actions from hook_action_info() implementations are put into the database when <a class="el" href="actions_8inc.html#a4445cbadb5d03206c4a724581b2b30c">actions_synchronize()</a> is called, which happens when admin/settings/actions is visited. Configurable actions are not added to the database until they are configured in the user interface, in which case a database row is created for each configuration of each action.<p>
<dl class="return" compact><dt><b>Returns:</b></dt><dd>Associative array keyed by action ID. Each value is an associative array with keys 'callback', 'description', 'type' and 'configurable'. </dd></dl>

</div>
</div><p>
<a class="anchor" name="d0dbf276d4ca1834760cffc7e1b1be53"></a><!-- doxytag: member="actions.inc::actions_list" ref="d0dbf276d4ca1834760cffc7e1b1be53" args="($reset=FALSE)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">actions_list           </td>
          <td>(</td>
          <td class="paramtype">$&nbsp;</td>
          <td class="paramname"> <em>reset</em> = <code>FALSE</code>          </td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Discover all action functions by invoking hook_action_info().<p>
<div class="fragment"><pre class="fragment"> mymodule_action_info() {
   <span class="keywordflow">return</span> array(
     <span class="stringliteral">'mymodule_functiondescription_action'</span> =&gt; array(
       <span class="stringliteral">'type'</span> =&gt; <span class="stringliteral">'node'</span>,
       <span class="stringliteral">'description'</span> =&gt; <a class="code" href="common_8inc.html#41d20f0c822bf1f3c26a97981c762665">t</a>(<span class="stringliteral">'Save node'</span>),
       <span class="stringliteral">'configurable'</span> =&gt; FALSE,
       <span class="stringliteral">'hooks'</span> =&gt; array(
         <span class="stringliteral">'nodeapi'</span> =&gt; array(<span class="stringliteral">'delete'</span>, <span class="stringliteral">'insert'</span>, <span class="stringliteral">'update'</span>, <span class="stringliteral">'view'</span>),
         <span class="stringliteral">'comment'</span> =&gt; array(<span class="stringliteral">'delete'</span>, <span class="stringliteral">'insert'</span>, <span class="stringliteral">'update'</span>, <span class="stringliteral">'view'</span>),
       )
     )
   );
 }
</pre></div><p>
The description is used in presenting possible actions to the user for configuration. The type is used to present these actions in a logical grouping and to denote context. Some types are 'node', 'user', 'comment', and 'system'. If an action is configurable it will provide form, validation and submission functions. The hooks the action supports are declared in the 'hooks' array.<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>$reset</em>&nbsp;</td><td>Reset the action info static cache.</td></tr>
  </table>
</dl>
<dl class="return" compact><dt><b>Returns:</b></dt><dd>An associative array keyed on function name. The value of each key is an array containing information about the action, such as type of action and description of the action, e.g.,</dd></dl>
<div class="fragment"><pre class="fragment">   $actions[<span class="stringliteral">'node_publish_action'</span>] = array(
     <span class="stringliteral">'type'</span> =&gt; <span class="stringliteral">'node'</span>,
     <span class="stringliteral">'description'</span> =&gt; <a class="code" href="common_8inc.html#41d20f0c822bf1f3c26a97981c762665">t</a>(<span class="stringliteral">'Publish post'</span>),
     <span class="stringliteral">'configurable'</span> =&gt; FALSE,
     <span class="stringliteral">'hooks'</span> =&gt; array(
       <span class="stringliteral">'nodeapi'</span> =&gt; array(<span class="stringliteral">'presave'</span>, <span class="stringliteral">'insert'</span>, <span class="stringliteral">'update'</span>, <span class="stringliteral">'view'</span>),
       <span class="stringliteral">'comment'</span> =&gt; array(<span class="stringliteral">'delete'</span>, <span class="stringliteral">'insert'</span>, <span class="stringliteral">'update'</span>, <span class="stringliteral">'view'</span>),
     ),
   );
</pre></div> 
</div>
</div><p>
<a class="anchor" name="1e953639945d342b20fe51b8d21095cc"></a><!-- doxytag: member="actions.inc::actions_load" ref="1e953639945d342b20fe51b8d21095cc" args="($aid)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">actions_load           </td>
          <td>(</td>
          <td class="paramtype">$&nbsp;</td>
          <td class="paramname"> <em>aid</em>          </td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Retrieve a single action from the database.<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>$aid</em>&nbsp;</td><td>integer The ID of the action to retrieve.</td></tr>
  </table>
</dl>
<dl class="return" compact><dt><b>Returns:</b></dt><dd>The appropriate action row from the database as an object. </dd></dl>

</div>
</div><p>
<a class="anchor" name="58e2d372003a208c732f98cfb00b1c98"></a><!-- doxytag: member="actions.inc::actions_save" ref="58e2d372003a208c732f98cfb00b1c98" args="($function, $type, $params, $desc, $aid=NULL)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">actions_save           </td>
          <td>(</td>
          <td class="paramtype">$&nbsp;</td>
          <td class="paramname"> <em>function</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">$&nbsp;</td>
          <td class="paramname"> <em>type</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">$&nbsp;</td>
          <td class="paramname"> <em>params</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">$&nbsp;</td>
          <td class="paramname"> <em>desc</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">$&nbsp;</td>
          <td class="paramname"> <em>aid</em> = <code>NULL</code></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Save an action and its associated user-supplied parameter values to the database.<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>$function</em>&nbsp;</td><td>The name of the function to be called when this action is performed. </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>$type</em>&nbsp;</td><td>The type of action, to describe grouping and/or context, e.g., 'node', 'user', 'comment', or 'system'. </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>$params</em>&nbsp;</td><td>An associative array with parameter names as keys and parameter values as values. </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>$desc</em>&nbsp;</td><td>A user-supplied description of this particular action, e.g., 'Send e-mail to Jim'. </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>$aid</em>&nbsp;</td><td>The ID of this action. If omitted, a new action is created.</td></tr>
  </table>
</dl>
<dl class="return" compact><dt><b>Returns:</b></dt><dd>The ID of the action. </dd></dl>

</div>
</div><p>
<a class="anchor" name="a4445cbadb5d03206c4a724581b2b30c"></a><!-- doxytag: member="actions.inc::actions_synchronize" ref="a4445cbadb5d03206c4a724581b2b30c" args="($actions_in_code=array(), $delete_orphans=FALSE)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">actions_synchronize           </td>
          <td>(</td>
          <td class="paramtype">$&nbsp;</td>
          <td class="paramname"> <em>actions_in_code</em> = <code>array()</code>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">$&nbsp;</td>
          <td class="paramname"> <em>delete_orphans</em> = <code>FALSE</code></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Synchronize actions that are provided by modules.<p>
They are synchronized with actions that are stored in the actions table. This is necessary so that actions that do not require configuration can receive action IDs. This is not necessarily the best approach, but it is the most straightforward. 
</div>
</div><p>
</div>
<hr size="1"><address style="text-align: right;"><small>Generated on Sat Feb 12 18:59:44 2011 by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border="0"></a> 1.5.8 </small></address>
</body>
</html>
